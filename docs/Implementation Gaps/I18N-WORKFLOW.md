# SK AutoSphere Internationalization (i18n) Workflow

**Status**: üü° Mock Implementation (Current) -> üü¢ Next-Intl (Target)
**Goal**: Replace the current hardcoded `lib/i18n.ts` with a production-grade `next-intl` system, while preserving the existing AI translation service.

---

## üõë Current State Analysis

The "Recommended Approach" documentation suggests we are 80% done with `next-intl`. **This is incorrect.**

- ‚ùå **No `next-intl` package**: It is not installed.
- ‚ùå **No `messages/` folder**: All translations are in a single 30KB TS file (`lib/i18n.ts`).
- ‚ùå **No Middleware Logic**: `middleware.ts` only handles Supabase Auth.
- ‚úÖ **AI Backend**: We _do_ have `lib/translation/service.ts` which handles dynamic AI translation caching.

---

## üéØ Implementation Roadmap (The Real Phase 1)

This workflow outlines the necessary steps to actually implement the "Phase 1" recommendations.

### Step 1: Install Dependencies

```bash
npm install next-intl
```

### Step 2: Create Message Structure

Move the massive object from `lib/i18n.ts` into individual JSON files.

- `messages/en.json` (Source of Truth)
- `messages/ko.json`
- `messages/fr.json`
- `messages/sw.json`

### Step 3: Configure `i18n` Plugin

Create `src/i18n/request.ts` (or `i18n.ts` in root for Next 15):

```typescript
import { getRequestConfig } from "next-intl/server";

export default getRequestConfig(async ({ requestLocale }) => {
  let locale = await requestLocale;
  // logic to validate locale...

  return {
    locale,
    messages: (await import(`../../messages/${locale}.json`)).default,
  };
});
```

### Step 4: Update Middleware (Complex)

We must chain `next-intl` middleware with `Supabase Auth` middleware.

```typescript
import { createMiddleware } from "next-intl/middleware";
import { updateSession } from "@/utils/supabase/middleware"; // Refactored auth

const intlMiddleware = createMiddleware({
  locales: ["en", "ko", "fr", "sw"],
  defaultLocale: "en",
});

export default function middleware(req: NextRequest) {
  // 1. Run Intl Middleware (for locale detection)
  const res = intlMiddleware(req);

  // 2. Run Supabase Auth (using the locale-aware response)
  // This requires careful chaining to not overwrite cookies/headers
  // ...
}
```

### Step 5: Refactor Components

Replace the custom mock hook with the real one.

**Current (Mock):**

```typescript
import { useTranslation } from "@/hooks/use-translation";
const { t } = useTranslation("homepage");
```

**Target (Next-Intl):**

```typescript
import { useTranslations } from "next-intl";
const t = useTranslations("homepage");
```

---

## üîÆ Phase 2: Connect AI Translation (Week 2)

Once the static UI system (`next-intl`) is running, connect it to our existing `TranslationService`.

1.  **Dynamic Content**: Use `TranslationService.translateListingField()` for database content.
2.  **Caching**: Ensure `listing_translations` table is populated.
3.  **SEO**: Verify `hreflang` tags are generated by `next-intl`.

---

## ‚ö†Ô∏è Risks & Considerations

1.  **Middleware Conflict**: Chaining Supabase Auth + Next-Intl is notoriously tricky. If done wrong, auth breaks or infinite redirects occur.
2.  **Build Breakage**: Removing `lib/i18n.ts` will break ~50 components instantly. We must do this incrementally or all at once in a feature branch.

**Recommendation**: Do **NOT** attempt this migration during the current "Gap Remediation" sprint. Focus on the Backend Gaps (Parts, Orders) first. This is an enhancement, not a functional fix.
